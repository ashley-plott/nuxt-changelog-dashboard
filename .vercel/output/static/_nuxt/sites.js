import{g,q as w,r as b,c as o,a as e,l as r,k as i,v as c,m as l,s as k,t as x,F as h,x as M,o as d}from"./entry.js";const S={class:"p-6 space-y-8 max-w-3xl"},D={class:"border rounded-xl p-5 space-y-4"},C={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},U={class:"md:col-span-2"},V={class:"flex gap-3 pt-2"},K=["disabled"],N={key:0,class:"text-red-600 text-sm mt-2"},_={key:1,class:"mt-4 text-sm"},L={class:"bg-gray-50 p-3 rounded overflow-auto"},E={key:0,class:"border rounded-xl p-5"},A={class:"min-w-full text-sm"},B={class:"py-2 pr-4"},F={class:"py-2 pr-4"},P={key:0,class:"px-2 py-1 rounded text-xs bg-amber-50"},T={key:1,class:"ml-2 px-2 py-1 rounded text-xs bg-blue-50"},R=g({__name:"sites",setup(q){const s=w({id:"",name:"",env:"production",renewMonth:new Date().getMonth()+1,adminKey:""}),u=b(null),m=b(null),p=b(!1);async function y(){p.value=!0,m.value=null,u.value=null;try{const a=await $fetch("/api/scheduler/sites",{method:"POST",headers:{"x-admin-key":s.adminKey},body:{id:s.id.trim(),name:s.name.trim()||s.id.trim(),env:s.env,renewMonth:Number(s.renewMonth)}});u.value=a}catch(a){m.value=a?.data?.message||a?.message||"Failed"}finally{p.value=!1}}const v=b(null);async function f(){v.value=await $fetch("/api/scheduler/maintenance",{query:{site:s.id,env:s.env}})}return(a,t)=>(d(),o("div",S,[t[16]||(t[16]=e("h1",{class:"text-2xl font-bold"},"Sites & Maintenance",-1)),e("div",D,[t[13]||(t[13]=e("h2",{class:"text-lg font-semibold"},"Add Site",-1)),e("div",C,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium"},"Site ID (slug)",-1)),i(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>l(s).id=n),class:"border rounded px-3 py-2 w-full",placeholder:"cc-london"},null,512),[[c,l(s).id]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium"},"Name",-1)),i(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>l(s).name=n),class:"border rounded px-3 py-2 w-full",placeholder:"Clements & Church (London)"},null,512),[[c,l(s).name]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium"},"Environment",-1)),i(e("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>l(s).env=n),class:"border rounded px-3 py-2 w-full"},[...t[7]||(t[7]=[e("option",{value:"production"},"production",-1),e("option",{value:"staging"},"staging",-1),e("option",{value:"dev"},"dev",-1),e("option",{value:"test"},"test",-1)])],512),[[k,l(s).env]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium"},"Renew Month (1-12)",-1)),i(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>l(s).renewMonth=n),type:"number",min:"1",max:"12",class:"border rounded px-3 py-2 w-full"},null,512),[[c,l(s).renewMonth,void 0,{number:!0}]]),t[10]||(t[10]=e("p",{class:"text-xs text-gray-500 mt-1"},"Pre‑renewal is one month before this.",-1))]),e("div",U,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium"},"Admin Key",-1)),i(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>l(s).adminKey=n),class:"border rounded px-3 py-2 w-full",placeholder:"Enter NUXT_ADMIN_KEY"},null,512),[[c,l(s).adminKey]])])]),e("div",V,[e("button",{onClick:y,disabled:l(p),class:"px-4 py-2 rounded bg-black text-white"},x(l(p)?"Saving…":"Save & Generate Schedule"),9,K),e("button",{onClick:f,class:"px-4 py-2 rounded border"},"Load Schedule")]),l(m)?(d(),o("p",N,x(l(m)),1)):r("",!0),l(u)?(d(),o("div",_,[t[12]||(t[12]=e("p",{class:"font-medium"},"Created/Updated:",-1)),e("pre",L,x(l(u)),1)])):r("",!0)]),l(v)?.items?(d(),o("div",E,[t[15]||(t[15]=e("h2",{class:"text-lg font-semibold mb-3"},"Schedule",-1)),e("table",A,[t[14]||(t[14]=e("thead",null,[e("tr",{class:"text-left border-b"},[e("th",{class:"py-2 pr-4"},"Date"),e("th",{class:"py-2 pr-4"},"Labels")])],-1)),e("tbody",null,[(d(!0),o(h,null,M(l(v).items,n=>(d(),o("tr",{key:n.date,class:"border-b last:border-0"},[e("td",B,[e("code",null,x(new Date(n.date).toLocaleDateString()),1)]),e("td",F,[n.labels?.preRenewal?(d(),o("span",P,"Pre‑renewal")):r("",!0),n.labels?.midYear?(d(),o("span",T,"Mid‑year")):r("",!0)])]))),128))])])])):r("",!0)]))}});export{R as default};
