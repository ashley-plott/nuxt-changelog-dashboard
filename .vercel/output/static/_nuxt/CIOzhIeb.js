import{_ as J}from"./27xiAL-V.js";import{g as X,j as ee,r as C,y as M,c as o,a as t,b as te,m as i,w as m,z as $,F as p,k as v,A as j,t as a,l as c,x as h,p as R,v as se,s as O,B as ne,o as n,d as y,C as _}from"#entry";import{u as oe}from"./DrutMbgO.js";const ae={class:"p-6 space-y-6"},ie={class:"flex items-center justify-between"},re={class:"flex items-center gap-3"},le=["disabled"],de={class:"inline-flex rounded-xl border bg-gray-50 p-1"},ce={key:0},ue={key:1,class:"text-red-600"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe={class:"rounded-2xl border bg-white p-5 shadow-sm"},ge={class:"flex items-center justify-between"},he={class:"text-xs rounded-full bg-gray-100 px-2 py-1"},me={key:0,class:"mt-3 space-y-2"},ye={class:"min-w-0"},_e={class:"truncate font-medium"},ve={class:"text-xs text-gray-500 truncate"},be={class:"capitalize"},we={class:"flex gap-2 text-xs"},fe={key:0,class:"px-2 py-0.5 rounded-full bg-amber-50 text-amber-800 border border-amber-100"},ke={key:1,class:"px-2 py-0.5 rounded-full bg-blue-50 text-blue-800 border border-blue-100"},Ce={key:0,class:"text-xs text-gray-500"},Me={key:1,class:"text-sm text-gray-500"},Ne={class:"rounded-2xl border bg-white p-5 shadow-sm"},Se={class:"flex items-center justify-between"},$e={class:"text-xs rounded-full bg-gray-100 px-2 py-1"},je={key:0,class:"mt-3 space-y-2"},Re={class:"min-w-0"},Ue={class:"truncate font-medium"},De={class:"text-xs text-gray-500 truncate"},Le={class:"capitalize"},ze={key:0,class:"text-xs text-gray-500"},Te={key:1,class:"text-sm text-gray-500"},Ve={class:"rounded-2xl border bg-white p-5 shadow-sm"},Fe={class:"flex items-center justify-between"},Ae={class:"text-xs rounded-full bg-gray-100 px-2 py-1"},Be={key:0,class:"mt-3 space-y-2"},Oe={class:"min-w-0"},Ye={class:"truncate font-medium"},Ie={class:"text-xs text-gray-500 truncate"},Ee={class:"capitalize"},Pe={class:"text-xs text-gray-600"},qe={key:0,class:"text-xs text-gray-500"},He={key:1,class:"text-sm text-gray-500"},Ke={class:"space-y-3"},Qe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},We={class:"flex items-center justify-between"},Ze={class:"text-base font-semibold"},Ge={class:"flex items-center gap-2 text-xs"},Je={class:"rounded-full bg-gray-100 px-2 py-0.5"},Xe={class:"rounded-full bg-gray-100 px-2 py-0.5"},et={class:"rounded-full bg-gray-100 px-2 py-0.5"},tt={class:"mt-4 space-y-3"},st={key:0,class:"space-y-1"},nt={class:"truncate"},ot={class:"flex gap-2 text-[11px]"},at={key:0,class:"px-1.5 py-0.5 rounded bg-amber-50 text-amber-800 border border-amber-100"},it={key:1,class:"px-1.5 py-0.5 rounded bg-blue-50 text-blue-800 border border-blue-100"},rt={key:0,class:"text-xs text-gray-500"},lt={key:1,class:"text-xs text-gray-500"},dt={key:0,class:"space-y-1"},ct={class:"truncate"},ut={key:0,class:"text-xs text-gray-500"},pt={key:1,class:"text-xs text-gray-500"},xt={key:0,class:"space-y-1"},gt={class:"truncate"},ht={class:"text-[11px] text-gray-600"},mt={key:0,class:"text-xs text-gray-500"},yt={key:1,class:"text-xs text-gray-500"},_t={class:"space-y-4"},vt={class:"grid grid-cols-1 lg:grid-cols-12 gap-3"},bt={class:"lg:col-span-6"},wt={class:"relative"},ft={class:"lg:col-span-3"},kt={class:"lg:col-span-1"},Ct={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},Mt={class:"flex items-start justify-between gap-3"},Nt={class:"flex items-center gap-3"},St={class:"h-10 w-10 rounded-xl bg-gray-100 flex items-center justify-center border"},$t={class:"text-sm font-semibold text-gray-600"},jt={class:"text-base font-semibold leading-tight"},Rt={class:"flex items-center gap-2 text-[11px] text-gray-500 truncate mt-0.5"},Ut={key:0},Dt=["href"],Lt={key:1},zt={key:0,class:"opacity-50"},Tt=["href"],Vt={key:2},Ft={key:0,class:"opacity-50"},At={class:"truncate"},Bt=["href"],Ot=["href"],Yt={class:"flex items-center gap-2 text-xs text-gray-500"},It={class:"capitalize"},Et={class:"text-right"},Pt={class:"text-sm font-medium"},qt={key:0},Ht={key:1,class:"text-gray-500"},Kt={class:"mt-4 flex items-center justify-between text-xs text-gray-500"},Qt={key:0,class:"inline-flex gap-1"},Xt=X({__name:"dashboard",async setup(Wt){let f,U;const{data:Y,pending:D,error:I,refresh:L}=([f,U]=ee(()=>oe("/api/scheduler/overview","$lE-HAwt7tD")),f=await f,U(),f),g=C("overview"),k=C(""),b=C("az"),w=C("all");function E(d){const s=["th","st","nd","rd"],r=d%100;return d+(s[(r-20)%10]||s[r]||s[0])}function P(d){if(!d)return"—";const s=new Date(d);return`${E(s.getDate())} ${s.toLocaleString(void 0,{month:"long"})} ${s.getFullYear()}`}function N(d){return d?new Date(2e3,(d||1)-1,1).toLocaleString(void 0,{month:"long"}):""}const z=M(()=>Y.value?.sites||[]),q=M(()=>{const d=k.value.trim().toLowerCase();let s=z.value.filter(r=>{const e=!d||String(r.name||"").toLowerCase().includes(d)||String(r.id||"").toLowerCase().includes(d)||String(r.domain||"").toLowerCase().includes(d),l=w.value==="all"||String(r.env||"").toLowerCase()===w.value;return e&&l});return b.value==="az"?s=s.sort((r,e)=>String(r.name||r.id).localeCompare(String(e.name||e.id))):b.value==="renew-asc"?s=s.sort((r,e)=>new Date(r.nextMaintenance||0).getTime()-new Date(e.nextMaintenance||0).getTime()):s=s.sort((r,e)=>new Date(e.nextMaintenance||0).getTime()-new Date(r.nextMaintenance||0).getTime()),s}),T=new Date,V=T.getUTCMonth(),H=T.getUTCFullYear(),F=d=>(Number(d||0)-1+12)%12,S=d=>(F(d)-2+12)%12,K=d=>(F(d)-1+12)%12,A=d=>(S(d)+6)%12,B=M(()=>{const d=[],s=z.value;for(let r=0;r<12;r++){const e=(V+r)%12,l=H+Math.floor((V+r)/12),Q=new Date(Date.UTC(l,e,1)).toLocaleString(void 0,{month:"long",year:"numeric"}),W=s.filter(x=>Number(x.renewMonth)===e+1),Z=s.filter(x=>S(Number(x.renewMonth))===e||A(Number(x.renewMonth))===e).map(x=>({...x,preRenewal:S(Number(x.renewMonth))===e,midYear:A(Number(x.renewMonth))===e})),G=s.filter(x=>K(Number(x.renewMonth))===e);d.push({key:`${l}-${e}`,label:Q,year:l,monthIdx:e,renewals:W,maintenance:Z,reports:G})}return d}),u=M(()=>B.value[0]);return(d,s)=>{const r=J;return n(),o("div",ae,[t("div",ie,[s[8]||(s[8]=t("div",null,[t("h1",{class:"text-2xl font-bold"},"Sites"),t("p",{class:"text-sm text-gray-500 mt-1"},"Search and browse environments")],-1)),t("div",re,[t("button",{onClick:s[0]||(s[0]=(...e)=>i(L)&&i(L)(...e)),class:"px-4 py-2 rounded-lg bg-black text-white shadow-sm disabled:opacity-60",disabled:i(D)},"Refresh",8,le),te(r,{to:"/sites",class:"px-4 py-2 rounded-lg bg-black text-white shadow-sm"},{default:m(()=>[...s[7]||(s[7]=[y("Add Site",-1)])]),_:1})])]),t("div",de,[t("button",{onClick:s[1]||(s[1]=e=>g.value="overview"),class:$(["px-4 py-2 rounded-lg text-sm transition",i(g)==="overview"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Overview",2),t("button",{onClick:s[2]||(s[2]=e=>g.value="months"),class:$(["px-4 py-2 rounded-lg text-sm transition",i(g)==="months"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Months",2),t("button",{onClick:s[3]||(s[3]=e=>g.value="sites"),class:$(["px-4 py-2 rounded-lg text-sm transition",i(g)==="sites"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Sites",2)]),i(D)?(n(),o("div",ce,"Loading…")):i(I)?(n(),o("div",ue,"Failed to load sites.")):(n(),o(p,{key:2},[v(t("div",pe,[t("div",xe,[t("div",ge,[s[9]||(s[9]=t("h2",{class:"text-base font-semibold"},"Maintenance this month",-1)),t("span",he,a(i(u).maintenance.length),1)]),i(u).maintenance.length?(n(),o("div",me,[(n(!0),o(p,null,h(i(u).maintenance.slice(0,10),e=>(n(),_(r,{key:e.id,to:`/site/${e.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-2 hover:bg-gray-50"},{default:m(()=>[t("div",ye,[t("div",_e,a(e.name||e.id),1),t("div",ve,[y(a(e.id)+" • ",1),t("span",be,a(e.env),1)])]),t("div",we,[e.preRenewal?(n(),o("span",fe,"Pre-renewal")):c("",!0),e.midYear?(n(),o("span",ke,"Mid-year")):c("",!0)])]),_:2},1032,["to"]))),128)),i(u).maintenance.length>10?(n(),o("p",Ce,"…and "+a(i(u).maintenance.length-10)+" more",1)):c("",!0)])):(n(),o("p",Me,"No maintenance scheduled this month."))]),t("div",Ne,[t("div",Se,[s[10]||(s[10]=t("h2",{class:"text-base font-semibold"},"Reports due this month",-1)),t("span",$e,a(i(u).reports.length),1)]),i(u).reports.length?(n(),o("div",je,[(n(!0),o(p,null,h(i(u).reports.slice(0,10),e=>(n(),_(r,{key:e.id,to:`/site/${e.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-2 hover:bg-gray-50"},{default:m(()=>[t("div",Re,[t("div",Ue,a(e.name||e.id),1),t("div",De,[y(a(e.id)+" • ",1),t("span",Le,a(e.env),1)])]),s[11]||(s[11]=t("span",{class:"text-xs px-2 py-0.5 rounded-full bg-violet-50 text-violet-700 border border-violet-100"},"Report",-1))]),_:2},1032,["to"]))),128)),i(u).reports.length>10?(n(),o("p",ze,"…and "+a(i(u).reports.length-10)+" more",1)):c("",!0)])):(n(),o("p",Te,"No reports due this month."))]),t("div",Ve,[t("div",Fe,[s[12]||(s[12]=t("h2",{class:"text-base font-semibold"},"Renewals this month",-1)),t("span",Ae,a(i(u).renewals.length),1)]),i(u).renewals.length?(n(),o("div",Be,[(n(!0),o(p,null,h(i(u).renewals.slice(0,10),e=>(n(),_(r,{key:e.id,to:`/site/${e.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-2 hover:bg-gray-50"},{default:m(()=>[t("div",Oe,[t("div",Ye,a(e.name||e.id),1),t("div",Ie,[y(a(e.id)+" • ",1),t("span",Ee,a(e.env),1)])]),t("span",Pe,a(N(e.renewMonth)),1)]),_:2},1032,["to"]))),128)),i(u).renewals.length>10?(n(),o("p",qe,"…and "+a(i(u).renewals.length-10)+" more",1)):c("",!0)])):(n(),o("p",He,"No renewals this month."))])],512),[[j,i(g)==="overview"]]),v(t("div",Ke,[s[17]||(s[17]=t("h2",{class:"text-lg font-semibold"},"Month-by-month overview",-1)),t("div",Qe,[(n(!0),o(p,null,h(i(B),e=>(n(),o("div",{key:e.key,class:"rounded-2xl border bg-white p-5 shadow-sm"},[t("div",We,[t("h3",Ze,a(e.label),1),t("div",Ge,[t("span",Je,"Maint: "+a(e.maintenance.length),1),t("span",Xe,"Reports: "+a(e.reports.length),1),t("span",et,"Renew: "+a(e.renewals.length),1)])]),t("div",tt,[t("div",null,[s[13]||(s[13]=t("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Maintenance",-1)),e.maintenance.length?(n(),o("div",st,[(n(!0),o(p,null,h(e.maintenance.slice(0,4),l=>(n(),_(r,{key:l.id,to:`/site/${l.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-1.5 text-sm hover:bg-gray-50"},{default:m(()=>[t("div",nt,a(l.name||l.id),1),t("div",ot,[l.preRenewal?(n(),o("span",at,"Pre")):c("",!0),l.midYear?(n(),o("span",it,"Mid")):c("",!0)])]),_:2},1032,["to"]))),128)),e.maintenance.length>4?(n(),o("div",rt,"…and "+a(e.maintenance.length-4)+" more",1)):c("",!0)])):(n(),o("div",lt,"No maintenance."))]),t("div",null,[s[15]||(s[15]=t("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Reports",-1)),e.reports.length?(n(),o("div",dt,[(n(!0),o(p,null,h(e.reports.slice(0,4),l=>(n(),_(r,{key:l.id,to:`/site/${l.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-1.5 text-sm hover:bg-gray-50"},{default:m(()=>[t("div",ct,a(l.name||l.id),1),s[14]||(s[14]=t("span",{class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-100"},"Report",-1))]),_:2},1032,["to"]))),128)),e.reports.length>4?(n(),o("div",ut,"…and "+a(e.reports.length-4)+" more",1)):c("",!0)])):(n(),o("div",pt,"No reports."))]),t("div",null,[s[16]||(s[16]=t("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Renewals",-1)),e.renewals.length?(n(),o("div",xt,[(n(!0),o(p,null,h(e.renewals.slice(0,4),l=>(n(),_(r,{key:l.id,to:`/site/${l.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-1.5 text-sm hover:bg-gray-50"},{default:m(()=>[t("div",gt,a(l.name||l.id),1),t("span",ht,a(N(l.renewMonth)),1)]),_:2},1032,["to"]))),128)),e.renewals.length>4?(n(),o("div",mt,"…and "+a(e.renewals.length-4)+" more",1)):c("",!0)])):(n(),o("div",yt,"No renewals."))])])]))),128))])],512),[[j,i(g)==="months"]]),v(t("div",_t,[t("div",vt,[t("div",bt,[t("div",wt,[v(t("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>R(k)?k.value=e:null),type:"search",placeholder:"Search sites…",class:"w-full border rounded-xl px-4 py-2.5 bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-black/10"},null,512),[[se,i(k)]]),s[18]||(s[18]=t("div",{class:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"},"⌘K",-1))])]),t("div",ft,[s[20]||(s[20]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Sort",-1)),v(t("select",{"onUpdate:modelValue":s[5]||(s[5]=e=>R(b)?b.value=e:null),class:"w-full border rounded-xl px-3 py-2.5 bg-white shadow-sm"},[...s[19]||(s[19]=[t("option",{value:"az"},"A–Z",-1),t("option",{value:"renew-asc"},"Next maintenance ↑",-1),t("option",{value:"renew-desc"},"Next maintenance ↓",-1)])],512),[[O,i(b)]])]),t("div",kt,[s[22]||(s[22]=t("label",{class:"block text-xs text-gray-500 mb-1"},"Env",-1)),v(t("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>R(w)?w.value=e:null),class:"w-full border rounded-xl px-3 py-2.5 bg-white shadow-sm"},[...s[21]||(s[21]=[ne('<option value="all">All</option><option value="production">prod</option><option value="staging">stage</option><option value="dev">dev</option><option value="test">test</option>',5)])],512),[[O,i(w)]])])]),t("div",Ct,[(n(!0),o(p,null,h(i(q),e=>(n(),_(r,{key:e.id,to:`/site/${e.id}`,class:"group block rounded-2xl border p-5 bg-white shadow-sm hover:shadow-md transition"},{default:m(()=>[t("div",Mt,[t("div",Nt,[t("div",St,[t("span",$t,a((e.name||e.id||"?").slice(0,1).toUpperCase()),1)]),t("div",null,[t("h3",jt,a(e.name||e.id),1),t("div",Rt,[e.websiteUrl?(n(),o("span",Ut,[t("a",{href:e.websiteUrl,target:"_blank",class:"hover:underline"},"Website",8,Dt)])):c("",!0),e.gitUrl?(n(),o("span",Lt,[e.websiteUrl?(n(),o("span",zt,"•")):c("",!0),t("a",{href:e.gitUrl,target:"_blank",class:"hover:underline"},"Repo",8,Tt)])):c("",!0),e.primaryContact?.email||e.primaryContact?.name||e.primaryContact?.phone?(n(),o("span",Vt,[e.websiteUrl||e.gitUrl?(n(),o("span",Ft,"•")):c("",!0),t("span",At,[y(a(e.primaryContact?.name||"Contact")+" ",1),e.primaryContact?.email?(n(),o(p,{key:0},[s[23]||(s[23]=y(" — ",-1)),t("a",{href:`mailto:${e.primaryContact.email}`,class:"hover:underline"},a(e.primaryContact.email),9,Bt)],64)):e.primaryContact?.phone?(n(),o(p,{key:1},[s[24]||(s[24]=y(" — ",-1)),t("a",{href:`tel:${e.primaryContact.phone}`,class:"hover:underline"},a(e.primaryContact.phone),9,Ot)],64)):c("",!0)])])):c("",!0)]),t("div",Yt,[t("span",null,a(e.id),1),s[25]||(s[25]=t("span",{class:"h-1 w-1 rounded-full bg-gray-300"},null,-1)),t("span",It,a(e.env),1)])])]),t("div",Et,[s[26]||(s[26]=t("div",{class:"text-xs text-gray-500"},"Next maintenance",-1)),t("div",Pt,[e.nextMaintenance?(n(),o("span",qt,a(P(e.nextMaintenance)),1)):(n(),o("span",Ht,a(N(e.renewMonth)),1))])])]),t("div",Kt,[s[27]||(s[27]=t("span",{class:"inline-flex items-center gap-1 group-hover:text-gray-700"},"Open details →",-1)),e.tags?.length?(n(),o("span",Qt,[(n(!0),o(p,null,h(e.tags.slice(0,3),l=>(n(),o("span",{key:l,class:"px-2 py-0.5 rounded-full bg-gray-100 border"},a(l),1))),128))])):c("",!0)])]),_:2},1032,["to"]))),128))])],512),[[j,i(g)==="sites"]])],64))])}}});export{Xt as default};
