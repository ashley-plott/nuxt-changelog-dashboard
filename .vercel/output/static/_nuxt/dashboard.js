import{_ as K}from"./nuxt-link.js";import{g as X,j as ee,r as C,y as M,c as o,a as e,b as te,m as d,w as h,z as $,F as c,k as v,A as j,t as a,x as g,p as R,v as se,s as O,B as ne,o as n,d as y,C as _,l as u}from"./entry.js";import{u as oe}from"./fetch.js";const ae={class:"p-6 space-y-6"},ie={class:"flex items-center justify-between"},re={class:"flex items-center gap-3"},le=["disabled"],de={class:"inline-flex rounded-xl border bg-gray-50 p-1"},ce={key:0},ue={key:1,class:"text-red-600"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe={class:"rounded-2xl border bg-white p-5 shadow-sm"},me={class:"flex items-center justify-between"},ge={class:"text-xs rounded-full bg-gray-100 px-2 py-1"},he={key:0,class:"mt-3 space-y-2"},ye={class:"min-w-0"},_e={class:"truncate font-medium"},ve={class:"text-xs text-gray-500 truncate"},be={class:"capitalize"},fe={class:"flex gap-2 text-xs"},we={key:0,class:"px-2 py-0.5 rounded-full bg-amber-50 text-amber-800 border border-amber-100"},ke={key:1,class:"px-2 py-0.5 rounded-full bg-blue-50 text-blue-800 border border-blue-100"},Ce={key:1,class:"text-sm text-gray-500"},Me={class:"rounded-2xl border bg-white p-5 shadow-sm"},Ne={class:"flex items-center justify-between"},Se={class:"text-xs rounded-full bg-gray-100 px-2 py-1"},$e={key:0,class:"mt-3 space-y-2"},je={class:"min-w-0"},Re={class:"truncate font-medium"},Ue={class:"text-xs text-gray-500 truncate"},De={class:"capitalize"},Le={key:1,class:"text-sm text-gray-500"},ze={class:"rounded-2xl border bg-white p-5 shadow-sm"},Te={class:"flex items-center justify-between"},Ve={class:"text-xs rounded-full bg-gray-100 px-2 py-1"},Fe={key:0,class:"mt-3 space-y-2"},Ae={class:"min-w-0"},Be={class:"truncate font-medium"},Oe={class:"text-xs text-gray-500 truncate"},Ye={class:"capitalize"},Ie={class:"text-xs text-gray-600"},Ee={key:1,class:"text-sm text-gray-500"},Pe={class:"space-y-3"},qe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},He={class:"flex items-center justify-between"},Qe={class:"text-base font-semibold"},We={class:"flex items-center gap-2 text-xs"},Ze={class:"rounded-full bg-gray-100 px-2 py-0.5"},Ge={class:"rounded-full bg-gray-100 px-2 py-0.5"},Je={class:"rounded-full bg-gray-100 px-2 py-0.5"},Ke={class:"mt-4 space-y-3"},Xe={key:0,class:"space-y-1"},et={class:"truncate"},tt={class:"flex gap-2 text-[11px]"},st={key:0,class:"px-1.5 py-0.5 rounded bg-amber-50 text-amber-800 border border-amber-100"},nt={key:1,class:"px-1.5 py-0.5 rounded bg-blue-50 text-blue-800 border border-blue-100"},ot={key:1,class:"text-xs text-gray-500"},at={key:0,class:"space-y-1"},it={class:"truncate"},rt={key:1,class:"text-xs text-gray-500"},lt={key:0,class:"space-y-1"},dt={class:"truncate"},ct={class:"text-[11px] text-gray-600"},ut={key:1,class:"text-xs text-gray-500"},pt={class:"space-y-4"},xt={class:"grid grid-cols-1 lg:grid-cols-12 gap-3"},mt={class:"lg:col-span-6"},gt={class:"relative"},ht={class:"lg:col-span-3"},yt={class:"lg:col-span-1"},_t={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},vt={class:"flex items-start justify-between gap-3"},bt={class:"flex items-center gap-3"},ft={class:"h-10 w-10 rounded-xl bg-gray-100 flex items-center justify-center border"},wt={class:"text-sm font-semibold text-gray-600"},kt={class:"text-base font-semibold leading-tight"},Ct={class:"flex items-center gap-2 text-[11px] text-gray-500 truncate mt-0.5"},Mt={key:0},Nt=["href"],St={key:1},$t={key:0,class:"opacity-50"},jt=["href"],Rt={key:2},Ut={key:0,class:"opacity-50"},Dt={class:"truncate"},Lt=["href"],zt=["href"],Tt={class:"flex items-center gap-2 text-xs text-gray-500"},Vt={class:"capitalize"},Ft={class:"text-right"},At={class:"text-sm font-medium"},Bt={key:0},Ot={key:1,class:"text-gray-500"},Yt={class:"mt-4 flex items-center justify-between text-xs text-gray-500"},It={key:0,class:"inline-flex gap-1"},Qt=X({__name:"dashboard",async setup(Et){let w,U;const{data:Y,pending:D,error:I,refresh:L}=([w,U]=ee(()=>oe("/api/scheduler/overview","$lE-HAwt7tD")),w=await w,U(),w),x=C("overview"),k=C(""),b=C("az"),f=C("all");function E(l){const s=["th","st","nd","rd"],i=l%100;return l+(s[(i-20)%10]||s[i]||s[0])}function P(l){if(!l)return"—";const s=new Date(l);return`${E(s.getDate())} ${s.toLocaleString(void 0,{month:"long"})} ${s.getFullYear()}`}function N(l){return l?new Date(2e3,(l||1)-1,1).toLocaleString(void 0,{month:"long"}):""}const z=M(()=>Y.value?.sites||[]),q=M(()=>{const l=k.value.trim().toLowerCase();let s=z.value.filter(i=>{const t=!l||String(i.name||"").toLowerCase().includes(l)||String(i.id||"").toLowerCase().includes(l)||String(i.domain||"").toLowerCase().includes(l),r=f.value==="all"||String(i.env||"").toLowerCase()===f.value;return t&&r});return b.value==="az"?s=s.sort((i,t)=>String(i.name||i.id).localeCompare(String(t.name||t.id))):b.value==="renew-asc"?s=s.sort((i,t)=>new Date(i.nextMaintenance||0).getTime()-new Date(t.nextMaintenance||0).getTime()):s=s.sort((i,t)=>new Date(t.nextMaintenance||0).getTime()-new Date(i.nextMaintenance||0).getTime()),s}),T=new Date,V=T.getUTCMonth(),H=T.getUTCFullYear(),F=l=>(Number(l||0)-1+12)%12,S=l=>(F(l)-2+12)%12,Q=l=>(F(l)-1+12)%12,A=l=>(S(l)+6)%12,B=M(()=>{const l=[],s=z.value;for(let i=0;i<12;i++){const t=(V+i)%12,r=H+Math.floor((V+i)/12),W=new Date(Date.UTC(r,t,1)).toLocaleString(void 0,{month:"long",year:"numeric"}),Z=s.filter(p=>Number(p.renewMonth)===t+1),G=s.filter(p=>S(Number(p.renewMonth))===t||A(Number(p.renewMonth))===t).map(p=>({...p,preRenewal:S(Number(p.renewMonth))===t,midYear:A(Number(p.renewMonth))===t})),J=s.filter(p=>Q(Number(p.renewMonth))===t);l.push({key:`${r}-${t}`,label:W,year:r,monthIdx:t,renewals:Z,maintenance:G,reports:J})}return l}),m=M(()=>B.value[0]);return(l,s)=>{const i=K;return n(),o("div",ae,[e("div",ie,[s[8]||(s[8]=e("div",null,[e("h1",{class:"text-2xl font-bold"},"Sites"),e("p",{class:"text-sm text-gray-500 mt-1"},"Search and browse environments")],-1)),e("div",re,[e("button",{onClick:s[0]||(s[0]=(...t)=>d(L)&&d(L)(...t)),class:"px-4 py-2 rounded-lg bg-black text-white shadow-sm disabled:opacity-60",disabled:d(D)},"Refresh",8,le),te(i,{to:"/sites",class:"px-4 py-2 rounded-lg bg-black text-white shadow-sm"},{default:h(()=>[...s[7]||(s[7]=[y("Add Site",-1)])]),_:1})])]),e("div",de,[e("button",{onClick:s[1]||(s[1]=t=>x.value="overview"),class:$(["px-4 py-2 rounded-lg text-sm transition",d(x)==="overview"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Overview",2),e("button",{onClick:s[2]||(s[2]=t=>x.value="months"),class:$(["px-4 py-2 rounded-lg text-sm transition",d(x)==="months"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Months",2),e("button",{onClick:s[3]||(s[3]=t=>x.value="sites"),class:$(["px-4 py-2 rounded-lg text-sm transition",d(x)==="sites"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Sites",2)]),d(D)?(n(),o("div",ce,"Loading…")):d(I)?(n(),o("div",ue,"Failed to load sites.")):(n(),o(c,{key:2},[v(e("div",pe,[e("div",xe,[e("div",me,[s[9]||(s[9]=e("h2",{class:"text-base font-semibold"},"Maintenance this month",-1)),e("span",ge,a(d(m).maintenance.length),1)]),d(m).maintenance.length?(n(),o("div",he,[(n(!0),o(c,null,g(d(m).maintenance,t=>(n(),_(i,{key:t.id,to:`/site/${t.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-2 hover:bg-gray-50"},{default:h(()=>[e("div",ye,[e("div",_e,a(t.name||t.id),1),e("div",ve,[y(a(t.id)+" • ",1),e("span",be,a(t.env),1)])]),e("div",fe,[t.preRenewal?(n(),o("span",we,"Pre-renewal")):u("",!0),t.midYear?(n(),o("span",ke,"Mid-year")):u("",!0)])]),_:2},1032,["to"]))),128))])):(n(),o("p",Ce,"No maintenance scheduled this month."))]),e("div",Me,[e("div",Ne,[s[10]||(s[10]=e("h2",{class:"text-base font-semibold"},"Reports due this month",-1)),e("span",Se,a(d(m).reports.length),1)]),d(m).reports.length?(n(),o("div",$e,[(n(!0),o(c,null,g(d(m).reports,t=>(n(),_(i,{key:t.id,to:`/site/${t.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-2 hover:bg-gray-50"},{default:h(()=>[e("div",je,[e("div",Re,a(t.name||t.id),1),e("div",Ue,[y(a(t.id)+" • ",1),e("span",De,a(t.env),1)])]),s[11]||(s[11]=e("span",{class:"text-xs px-2 py-0.5 rounded-full bg-violet-50 text-violet-700 border border-violet-100"},"Report",-1))]),_:2},1032,["to"]))),128))])):(n(),o("p",Le,"No reports due this month."))]),e("div",ze,[e("div",Te,[s[12]||(s[12]=e("h2",{class:"text-base font-semibold"},"Renewals this month",-1)),e("span",Ve,a(d(m).renewals.length),1)]),d(m).renewals.length?(n(),o("div",Fe,[(n(!0),o(c,null,g(d(m).renewals,t=>(n(),_(i,{key:t.id,to:`/site/${t.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-2 hover:bg-gray-50"},{default:h(()=>[e("div",Ae,[e("div",Be,a(t.name||t.id),1),e("div",Oe,[y(a(t.id)+" • ",1),e("span",Ye,a(t.env),1)])]),e("span",Ie,a(N(t.renewMonth)),1)]),_:2},1032,["to"]))),128))])):(n(),o("p",Ee,"No renewals this month."))])],512),[[j,d(x)==="overview"]]),v(e("div",Pe,[s[17]||(s[17]=e("h2",{class:"text-lg font-semibold"},"Month-by-month overview",-1)),e("div",qe,[(n(!0),o(c,null,g(d(B),t=>(n(),o("div",{key:t.key,class:"rounded-2xl border bg-white p-5 shadow-sm"},[e("div",He,[e("h3",Qe,a(t.label),1),e("div",We,[e("span",Ze,"Maint: "+a(t.maintenance.length),1),e("span",Ge,"Reports: "+a(t.reports.length),1),e("span",Je,"Renew: "+a(t.renewals.length),1)])]),e("div",Ke,[e("div",null,[s[13]||(s[13]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Maintenance",-1)),t.maintenance.length?(n(),o("div",Xe,[(n(!0),o(c,null,g(t.maintenance,r=>(n(),_(i,{key:r.id,to:`/site/${r.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-1.5 text-sm hover:bg-gray-50"},{default:h(()=>[e("div",et,a(r.name||r.id),1),e("div",tt,[r.preRenewal?(n(),o("span",st,"Pre")):u("",!0),r.midYear?(n(),o("span",nt,"Mid")):u("",!0)])]),_:2},1032,["to"]))),128))])):(n(),o("div",ot,"No maintenance."))]),e("div",null,[s[15]||(s[15]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Reports",-1)),t.reports.length?(n(),o("div",at,[(n(!0),o(c,null,g(t.reports,r=>(n(),_(i,{key:r.id,to:`/site/${r.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-1.5 text-sm hover:bg-gray-50"},{default:h(()=>[e("div",it,a(r.name||r.id),1),s[14]||(s[14]=e("span",{class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-100"},"Report",-1))]),_:2},1032,["to"]))),128))])):(n(),o("div",rt,"No reports."))]),e("div",null,[s[16]||(s[16]=e("div",{class:"text-xs font-medium text-gray-600 mb-1"},"Renewals",-1)),t.renewals.length?(n(),o("div",lt,[(n(!0),o(c,null,g(t.renewals,r=>(n(),_(i,{key:r.id,to:`/site/${r.id}`,class:"flex items-center justify-between rounded-lg border px-3 py-1.5 text-sm hover:bg-gray-50"},{default:h(()=>[e("div",dt,a(r.name||r.id),1),e("span",ct,a(N(r.renewMonth)),1)]),_:2},1032,["to"]))),128))])):(n(),o("div",ut,"No renewals."))])])]))),128))])],512),[[j,d(x)==="months"]]),v(e("div",pt,[e("div",xt,[e("div",mt,[e("div",gt,[s[18]||(s[18]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Search Client",-1)),v(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>R(k)?k.value=t:null),type:"search",placeholder:"Search sites…",class:"w-full border rounded-xl px-4 py-2.5 bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-black/10"},null,512),[[se,d(k)]])])]),e("div",ht,[s[20]||(s[20]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Sort",-1)),v(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>R(b)?b.value=t:null),class:"w-full border rounded-xl px-3 py-2.5 bg-white shadow-sm"},[...s[19]||(s[19]=[e("option",{value:"az"},"A–Z",-1),e("option",{value:"renew-asc"},"Next maintenance ↑",-1),e("option",{value:"renew-desc"},"Next maintenance ↓",-1)])],512),[[O,d(b)]])]),e("div",yt,[s[22]||(s[22]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Env",-1)),v(e("select",{"onUpdate:modelValue":s[6]||(s[6]=t=>R(f)?f.value=t:null),class:"w-full border rounded-xl px-3 py-2.5 bg-white shadow-sm"},[...s[21]||(s[21]=[ne('<option value="all">All</option><option value="production">prod</option><option value="staging">stage</option><option value="dev">dev</option><option value="test">test</option>',5)])],512),[[O,d(f)]])])]),e("div",_t,[(n(!0),o(c,null,g(d(q),t=>(n(),_(i,{key:t.id,to:`/site/${t.id}`,class:"group block rounded-2xl border p-5 bg-white shadow-sm hover:shadow-md transition"},{default:h(()=>[e("div",vt,[e("div",bt,[e("div",ft,[e("span",wt,a((t.name||t.id||"?").slice(0,1).toUpperCase()),1)]),e("div",null,[e("h3",kt,a(t.name||t.id),1),e("div",Ct,[t.websiteUrl?(n(),o("span",Mt,[e("a",{href:t.websiteUrl,target:"_blank",class:"hover:underline"},"Website",8,Nt)])):u("",!0),t.gitUrl?(n(),o("span",St,[t.websiteUrl?(n(),o("span",$t,"•")):u("",!0),e("a",{href:t.gitUrl,target:"_blank",class:"hover:underline"},"Repo",8,jt)])):u("",!0),t.primaryContact?.email||t.primaryContact?.name||t.primaryContact?.phone?(n(),o("span",Rt,[t.websiteUrl||t.gitUrl?(n(),o("span",Ut,"•")):u("",!0),e("span",Dt,[y(a(t.primaryContact?.name||"Contact")+" ",1),t.primaryContact?.email?(n(),o(c,{key:0},[s[23]||(s[23]=y(" — ",-1)),e("a",{href:`mailto:${t.primaryContact.email}`,class:"hover:underline"},a(t.primaryContact.email),9,Lt)],64)):t.primaryContact?.phone?(n(),o(c,{key:1},[s[24]||(s[24]=y(" — ",-1)),e("a",{href:`tel:${t.primaryContact.phone}`,class:"hover:underline"},a(t.primaryContact.phone),9,zt)],64)):u("",!0)])])):u("",!0)]),e("div",Tt,[e("span",null,a(t.id),1),s[25]||(s[25]=e("span",{class:"h-1 w-1 rounded-full bg-gray-300"},null,-1)),e("span",Vt,a(t.env),1)])])]),e("div",Ft,[s[26]||(s[26]=e("div",{class:"text-xs text-gray-500"},"Next maintenance",-1)),e("div",At,[t.nextMaintenance?(n(),o("span",Bt,a(P(t.nextMaintenance)),1)):(n(),o("span",Ot,a(N(t.renewMonth)),1))])])]),e("div",Yt,[s[27]||(s[27]=e("span",{class:"inline-flex items-center gap-1 group-hover:text-gray-700"},"Open details →",-1)),t.tags?.length?(n(),o("span",It,[(n(!0),o(c,null,g(t.tags.slice(0,3),r=>(n(),o("span",{key:r,class:"px-2 py-0.5 rounded-full bg-gray-100 border"},a(r),1))),128))])):u("",!0)])]),_:2},1032,["to"]))),128))])],512),[[j,d(x)==="sites"]])],64))])}}});export{Qt as default};
