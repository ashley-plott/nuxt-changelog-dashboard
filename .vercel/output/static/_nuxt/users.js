import{g as F,j as P,q as M,r as y,c as l,a as e,k as v,v as b,m as t,s as N,F as h,x as w,$ as S,t as d,l as k,o as r}from"./entry.js";import{u as T}from"./fetch.js";const A={class:"p-6 space-y-6"},B={class:"rounded-2xl border bg-white p-5 shadow-sm"},L={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},H=["value"],R={class:"flex items-center gap-2"},j=["type"],q={class:"mt-3 flex items-center gap-3"},z=["disabled"],I={key:0,class:"text-emerald-700 text-sm"},O={key:1,class:"text-red-600 text-sm"},G={key:0},J={key:1,class:"text-red-600"},K={key:2,class:"min-w-full text-sm border rounded-xl bg-white overflow-hidden"},Q={class:"py-2 px-3"},W={class:"py-2 px-3"},X={class:"py-2 px-3"},Y=["value","onChange"],Z=["value"],ee={class:"py-2 px-3 text-right"},se=["onClick"],le=F({__name:"users",async setup(te){let c,_;const g=["viewer","manager","admin"],{data:C,refresh:f,pending:$,error:U}=([c,_]=P(()=>T("/api/users","$UyU86ksozc")),c=await c,_(),c),o=M({email:"",name:"",role:"viewer",password:""}),u=y(!1),m=y(null),x=y(null),p=y(!1);async function E(){m.value=x.value=null,u.value=!0;try{const n=await $fetch("/api/users",{method:"POST",body:o});await f();const s=n?.tempPassword||o.password||"";m.value=`User created${s?" — temporary password: "+s:""}`,o.email="",o.name="",o.role="viewer",o.password="",p.value=!1}catch(n){x.value=n?.data?.message||n?.message||"Failed to create user"}finally{u.value=!1}}async function D(n,s){await $fetch(`/api/users/${n}`,{method:"PATCH",body:{role:s}}),f()}async function V(n){confirm("Delete this user?")&&(await $fetch(`/api/users/${n}`,{method:"DELETE"}),f())}return(n,s)=>(r(),l("div",A,[s[8]||(s[8]=e("div",{class:"flex items-center gap-3"},[e("h1",{class:"text-2xl font-bold"},"Users")],-1)),e("div",B,[s[5]||(s[5]=e("h2",{class:"text-lg font-semibold mb-3"},"Add user",-1)),e("div",L,[v(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>t(o).email=a),type:"email",placeholder:"Email",class:"border rounded px-3 py-2 w-full"},null,512),[[b,t(o).email]]),v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>t(o).name=a),placeholder:"Name",class:"border rounded px-3 py-2 w-full"},null,512),[[b,t(o).name]]),v(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>t(o).role=a),class:"border rounded px-3 py-2 w-full"},[(r(),l(h,null,w(g,a=>e("option",{key:a,value:a},d(a),9,H)),64))],512),[[N,t(o).role]]),e("div",R,[v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>t(o).password=a),type:t(p)?"text":"password",placeholder:"Password (optional)",class:"border rounded px-3 py-2 w-full"},null,8,j),[[S,t(o).password]]),e("button",{class:"text-xs underline",onClick:s[4]||(s[4]=a=>p.value=!t(p))},d(t(p)?"Hide":"Show"),1)])]),e("div",q,[e("button",{onClick:E,disabled:t(u),class:"px-4 py-2 rounded bg-black text-white"},d(t(u)?"Creating…":"Create user"),9,z),t(m)?(r(),l("p",I,d(t(m)),1)):k("",!0),t(x)?(r(),l("p",O,d(t(x)),1)):k("",!0)]),s[6]||(s[6]=e("p",{class:"text-xs text-gray-500 mt-2"}," If no password is provided, a temporary one will be generated and shown once. ",-1))]),t($)?(r(),l("div",G,"Loading…")):t(U)?(r(),l("div",J,"Failed to load users.")):(r(),l("table",K,[s[7]||(s[7]=e("thead",{class:"bg-gray-50"},[e("tr",{class:"text-left"},[e("th",{class:"py-2 px-3"},"Email"),e("th",{class:"py-2 px-3"},"Name"),e("th",{class:"py-2 px-3"},"Role"),e("th",{class:"py-2 px-3"})])],-1)),e("tbody",null,[(r(!0),l(h,null,w(t(C)?.users||[],a=>(r(),l("tr",{key:a.id,class:"border-t"},[e("td",Q,d(a.email),1),e("td",W,d(a.name),1),e("td",X,[e("select",{value:a.role,onChange:i=>D(a.id,i.target.value),class:"border rounded px-2 py-1"},[(r(),l(h,null,w(g,i=>e("option",{key:i,value:i},d(i),9,Z)),64))],40,Y)]),e("td",ee,[e("button",{onClick:i=>V(a.id),class:"text-red-600 text-sm"},"Delete",8,se)])]))),128))])]))]))}});export{le as default};
