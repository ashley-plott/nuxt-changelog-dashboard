import{_ as Ie}from"./nuxt-link.js";import{g as Be,D as qe,j as se,y as C,r as c,E as _e,G as ze,H as Ge,q as ae,c as o,a as e,k as r,m as s,t as d,l as u,d as _,b as Ye,w as Je,z,A as G,F as $,x as R,p as M,s as de,v as p,I as Ke,o as n}from"./entry.js";import{u as Qe,a as ke}from"./fetch.js";const Xe={class:"space-y-6 md:space-y-8 p-4 sm:p-6"},Ze={class:"rounded-2xl border bg-white p-5 shadow-sm"},et={class:"flex items-start gap-4"},tt={class:"h-12 w-12 rounded-2xl border bg-gray-50 flex items-center justify-center overflow-hidden"},st=["src","alt"],lt={key:1,class:"text-sm font-semibold text-gray-600"},ot={class:"min-w-0"},nt={class:"text-2xl font-bold truncate"},at={class:"mt-1 text-xs text-gray-500 truncate"},dt={key:0},it={class:"capitalize"},rt={key:1},ut=["href"],mt={key:2},ct=["href"],pt={key:0,class:"mt-1 text-xs text-gray-500 truncate"},bt={key:0},xt={key:1},gt=["href"],vt={key:2},yt=["href"],ft={class:"ml-auto flex flex-wrap items-center gap-2"},ht={key:0,class:"inline-flex items-center gap-1 rounded-full border px-3 py-1 text-xs bg-gray-50"},wt={class:"mt-5"},_t={class:"inline-flex rounded-xl border bg-gray-50 p-1"},kt={key:0,class:"rounded-2xl border bg-white p-8 text-center text-sm text-gray-500 shadow-sm"},Ut={key:1,class:"rounded-2xl border bg-white p-8 text-center text-sm text-red-600 shadow-sm"},Ct={key:2,class:"space-y-3"},Mt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5"},$t={class:"flex items-center justify-between"},Rt={class:"text-base font-semibold"},St={key:0,class:"rounded-full border px-2 py-0.5 text-xs bg-emerald-50 text-emerald-700"},Dt={class:"mt-4 space-y-2"},Nt={class:"font-medium"},Tt={class:"text-xs text-gray-500"},Vt={class:"flex gap-2"},Pt={key:0,class:"px-2 py-0.5 rounded-full text-xs bg-violet-50 text-violet-700 border border-violet-100"},Ft={key:1,class:"px-2 py-0.5 rounded-full text-xs bg-amber-50 text-amber-800 border border-amber-100"},Et={key:2,class:"px-2 py-0.5 rounded-full text-xs bg-blue-50 text-blue-800 border border-blue-100"},Lt={key:0,class:"rounded-xl border border-dashed px-3 py-6 text-center text-sm text-gray-500"},jt={class:"space-y-3"},At={class:"rounded-2xl border bg-white p-5 shadow-sm space-y-4"},Ot={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},Wt={class:"md:col-span-1"},Ht=["value"],It={class:"md:col-span-1"},Bt={class:"md:col-span-1"},qt={class:"md:col-span-1"},zt={class:"md:col-span-1 flex items-end gap-2"},Gt=["disabled"],Yt={key:0,class:"text-sm text-gray-500"},Jt={key:1,class:"rounded-xl border border-dashed p-6 text-center text-sm text-gray-500"},Kt={key:2,class:"space-y-4"},Qt={class:"flex items-center justify-between gap-3"},Xt={class:"font-medium"},Zt={class:"text-xs text-gray-500"},es={key:0},ts={key:1},ss={class:"flex flex-wrap gap-2"},ls={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700"},os={class:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-1 text-xs text-emerald-700"},ns={class:"inline-flex items-center rounded-full bg-rose-50 px-2 py-1 text-xs text-rose-700"},as={key:0,class:"mt-3 overflow-auto rounded-lg border"},ds={class:"min-w-full text-sm"},is={class:"py-2 pl-3 pr-4 font-medium"},rs={class:"py-2 pr-4"},us={class:"py-2 pr-4"},ms={class:"py-2 pl-3 pr-4 font-medium text-emerald-700"},cs={class:"py-2 pr-4"},ps={class:"py-2 pl-3 pr-4 font-medium text-rose-700"},bs={class:"py-2 pr-4"},xs={key:1,class:"mt-3 text-sm text-gray-500"},gs={class:"mt-2"},vs=["href"],ys={class:"space-y-3"},fs={class:"rounded-2xl border bg-white p-5 shadow-sm space-y-4"},hs={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},ws=["value"],_s={class:"flex items-end gap-2"},ks=["disabled"],Us={key:0,class:"text-sm text-gray-500"},Cs={key:1,class:"rounded-xl border border-dashed p-6 text-center text-sm text-gray-500"},Ms={key:2,class:"space-y-4"},$s={class:"flex items-start justify-between gap-3"},Rs={class:"font-medium"},Ss={class:"text-xs text-gray-500"},Ds={class:"mt-3 overflow-auto rounded-lg border"},Ns={class:"min-w-full text-sm"},Ts={class:"py-2 pl-3 pr-4 font-medium"},Vs={class:"py-2 pr-4 break-all"},Ps={class:"text-xs text-gray-500 mt-2"},Fs={class:"space-y-3"},Es={key:0,class:"rounded-2xl border bg-white p-5 shadow-sm space-y-3"},Ls={class:"grid grid-cols-1 md:grid-cols-6 gap-3"},js={class:"inline-flex items-center gap-2 text-sm md:col-span-1"},As={class:"flex gap-3"},Os=["disabled"],Ws={key:1,class:"rounded-2xl border bg-white p-5 text-sm text-gray-500 shadow-sm"},Hs={class:"space-y-3"},Is={key:0,class:"flex justify-center"},Bs={key:1,class:"rounded-xl border border-dashed p-6 text-center text-sm text-gray-500 bg-white shadow-sm"},qs={class:"flex items-start justify-between gap-3"},zs={class:"flex items-center gap-2"},Gs={class:"font-semibold"},Ys={key:0,class:"px-2 py-0.5 rounded-full text-xs bg-amber-50 text-amber-800 border border-amber-100"},Js={class:"whitespace-pre-wrap text-sm mt-1"},Ks={class:"text-xs text-gray-500 mt-2"},Qs={key:0,class:"shrink-0 flex gap-2"},Xs=["onClick"],Zs=["onClick"],el={class:"space-y-3"},tl={class:"rounded-2xl border bg-white p-5 shadow-sm space-y-6"},sl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ll=["value"],ol=["disabled"],nl=["disabled"],al=["disabled"],dl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},il=["disabled"],rl=["disabled"],ul={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ml=["disabled"],cl=["disabled"],pl=["disabled"],bl={class:"flex flex-wrap items-center gap-3"},xl=["disabled"],gl={key:1,class:"text-sm text-emerald-700"},vl={key:2,class:"text-sm text-red-600"},yl={key:3,class:"text-sm text-gray-500"},fl={class:"rounded-xl border bg-gray-50 p-4"},hl={class:"flex flex-wrap items-end gap-3"},wl=["disabled"],_l=["disabled"],kl=["disabled"],Ul={key:0,class:"mt-2 text-sm text-emerald-700"},Cl={key:1,class:"mt-2 text-sm text-red-600"},Nl=Be({__name:"[id]",async setup(Ml,{expose:Ue}){let g,S;const v=qe().params.id,k=void 0;function Ce(a=new Date){return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),1))}function Me(a){return a.toLocaleString(void 0,{month:"long",year:"numeric"})}const ie=Ce(new Date),$e=Array.from({length:12},(a,t)=>{const D=new Date(Date.UTC(ie.getUTCFullYear(),ie.getUTCMonth()+t,1)),l=new Date(Date.UTC(D.getUTCFullYear(),D.getUTCMonth()+1,1));return{start:D,end:l}});function re(a,t){const D=a.dateObj.getTime();return D>=t.start.getTime()&&D<t.end.getTime()}const Y=a=>a?new Date(a).toISOString():void 0,{data:ue,pending:Re,error:Se,refresh:le}=([g,S]=se(()=>Qe(`/api/scheduler/sites/${v}`,{headers:k,key:`site-${v}`},"$bbReuBHqlH")),g=await g,S(),g),m=C(()=>ue.value?.site),me=C(()=>(ue.value?.items||[]).map(a=>({...a,dateObj:new Date(a.date)}))),b=c("calendar"),ce=([g,S]=se(()=>$fetch("/api/auth/me",{headers:k}).catch(()=>({authenticated:!1}))),g=await g,S(),g),L=!!ce?.authenticated,j=L?ce.user:null,oe=C(()=>{const a=m.value;return a?.websiteUrl||a?.url||""}),pe=C(()=>m.value?.gitUrl||""),w=C(()=>m.value?.primaryContact||null);function De(a){const t=Number(m.value?.renewMonth||0);return t?a.getUTCMonth()===t-1:!1}const h=c("");_e(()=>{m.value&&h.value===""&&(h.value=m.value.env||"")});const T=c(20),A=c(""),O=c(""),W=c(""),{data:be,pending:xe,refresh:ge}=([g,S]=se(()=>ke(`site-changelogs-${v}`,()=>$fetch("/api/changelogs",{query:{site:v,env:h.value||void 0,limit:T.value,pkg:A.value||void 0,from:Y(O.value),to:Y(W.value)},headers:k}),{watch:[h,T,A,O,W]})),g=await g,S(),g);function Ne(){T.value+=20}const V=c(20),H=c(""),I=c(""),B=c(""),{data:ve,pending:ye,refresh:fe}=([g,S]=se(()=>ke(`site-formlogs-${v}`,()=>$fetch("/api/form-logs",{query:{site:v,env:h.value||void 0,limit:V.value,email:H.value||void 0,from:Y(I.value),to:Y(B.value)},headers:k}),{watch:[h,V,H,I,B]})),g=await g,S(),g);function Te(){V.value+=20}const P=c(null);async function N(){P.value=await $fetch(`/api/sites/${v}/notes`,{query:{env:m.value?.env},headers:k})}ze(()=>{b.value==="notes"&&!P.value&&N()}),Ge(b,a=>{a==="notes"&&!P.value&&N()});const U=ae({title:"",body:"",pinned:!1}),J=c(!1);async function Ve(){if(L){J.value=!0;try{await $fetch(`/api/sites/${v}/notes`,{method:"POST",body:{...U,env:m.value?.env},headers:k}),U.title="",U.body="",U.pinned=!1,await N()}finally{J.value=!1}}}function Pe(a){return L?j.role==="admin"||j.role==="manager"||String(a.author?.id)===String(j.id):!1}async function Fe(a,t){await $fetch(`/api/sites/${v}/notes/${a._id}`,{method:"PATCH",body:t,headers:k}),await N()}async function Ee(a){confirm("Delete this note?")&&(await $fetch(`/api/sites/${v}/notes/${a._id}`,{method:"DELETE",headers:k}),await N())}const y=C(()=>L&&(j?.role==="admin"||j?.role==="manager"));function K(a){const t=(a||"").trim();if(!t)return"";try{return new URL(t.startsWith("http")?t:`https://${t}`).toString()}catch{return t}}const i=ae({name:"",env:"production",renewMonth:1,websiteUrl:"",gitUrl:"",contactName:"",contactEmail:"",contactPhone:""});_e(()=>{const a=m.value;a&&(i.name=a.name||"",i.env=a.env||"production",i.renewMonth=Number(a.renewMonth||1),i.websiteUrl=a.websiteUrl||a.url||"",i.gitUrl=a.gitUrl||"",i.contactName=a.primaryContact?.name||"",i.contactEmail=a.primaryContact?.email||"",i.contactPhone=a.primaryContact?.phone||"")});const Q=c(!1),X=c(null),Z=c(null);async function Le(){if(y.value){Q.value=!0,X.value=Z.value=null;try{await $fetch("/api/scheduler/sites",{method:"POST",body:{id:v,name:i.name,env:i.env,renewMonth:Number(i.renewMonth),websiteUrl:K(i.websiteUrl),gitUrl:K(i.gitUrl),primaryContact:{name:i.contactName?.trim()||null,email:i.contactEmail?.trim()||null,phone:i.contactPhone?.trim()||null}},headers:k}),h.value=i.env,await le(),X.value="Saved."}catch(a){Z.value=a?.data?.message||a?.message||"Failed to save"}finally{Q.value=!1}}}const F=ae({backfillMonths:12,forwardMonths:14}),E=c(!1),ee=c(null),te=c(null);async function je(){if(y.value&&confirm(`This will rebuild maintenance for ${i.name} (${i.env}). Continue?`)){E.value=!0,ee.value=te.value=null;try{const a=await $fetch("/api/scheduler/sites",{method:"POST",body:{id:v,name:i.name,env:i.env,renewMonth:Number(i.renewMonth),websiteUrl:K(i.websiteUrl),gitUrl:K(i.gitUrl),primaryContact:{name:i.contactName?.trim()||null,email:i.contactEmail?.trim()||null,phone:i.contactPhone?.trim()||null},rebuild:!0,backfillMonths:Number(F.backfillMonths),forwardMonths:Number(F.forwardMonths)},headers:k});await le(),ee.value=`Rebuilt from ${a?.scheduleWindow?.from} to ${a?.scheduleWindow?.to} (${a?.scheduleWindow?.count||0} dates).`}catch(a){te.value=a?.data?.message||a?.message||"Failed to rebuild"}finally{E.value=!1}}}const Ae=C(()=>(m.value?.name||m.value?.id||v).slice(0,1).toUpperCase()),q=C(()=>{const a=oe.value;try{return a?new URL(a).hostname:""}catch{return""}}),Oe=C(()=>q.value?`https://www.google.com/s2/favicons?sz=64&domain=${q.value}`:""),We=C(()=>q.value?`https://icons.duckduckgo.com/ip3/${q.value}.ico`:""),ne=c(!1),he=c(!1);function He(){ne.value?he.value=!0:ne.value=!0}return Ue({refreshSite:le}),(a,t)=>{const D=Ie;return n(),o("div",Xe,[e("div",Ze,[e("div",et,[e("div",tt,[s(q)&&!s(he)?(n(),o("img",{key:0,src:s(ne)?s(We):s(Oe),onError:He,alt:s(m)?.name||s(m)?.id||"Site",class:"h-6 w-6",decoding:"async",loading:"eager"},null,40,st)):(n(),o("span",lt,d(s(Ae)),1))]),e("div",ot,[e("h1",nt,d(s(m)?.name||s(m)?.id||s(v)),1),e("p",at,[_(d(s(m)?.id||s(v))+" ",1),s(m)?.env?(n(),o("span",dt,[t[30]||(t[30]=_(" • ",-1)),e("span",it,d(s(m).env),1)])):u("",!0),s(oe)?(n(),o("span",rt,[t[31]||(t[31]=_(" • ",-1)),e("a",{href:s(oe),target:"_blank",class:"hover:underline"},"Website",8,ut)])):u("",!0),s(pe)?(n(),o("span",mt,[t[32]||(t[32]=_(" • ",-1)),e("a",{href:s(pe),target:"_blank",class:"hover:underline"},"Repo",8,ct)])):u("",!0)]),s(w)?.name||s(w)?.email||s(w)?.phone?(n(),o("p",pt,[t[35]||(t[35]=_(" Contact: ",-1)),s(w)?.name?(n(),o("span",bt,d(s(w).name),1)):u("",!0),s(w)?.email?(n(),o("span",xt,[t[33]||(t[33]=_(" • ",-1)),e("a",{href:`mailto:${s(w).email}`,class:"hover:underline"},d(s(w).email),9,gt)])):u("",!0),s(w)?.phone?(n(),o("span",vt,[t[34]||(t[34]=_(" • ",-1)),e("a",{href:`tel:${s(w).phone}`,class:"hover:underline"},d(s(w).phone),9,yt)])):u("",!0)])):u("",!0)]),e("div",ft,[s(m)?(n(),o("span",ht,[t[36]||(t[36]=e("span",{class:"h-1.5 w-1.5 rounded-full bg-emerald-500"},null,-1)),_(" Renew: "+d(new Date(2e3,(s(m).renewMonth||1)-1,1).toLocaleString(void 0,{month:"long"})),1)])):u("",!0),Ye(D,{to:"/dashboard",class:"inline-flex items-center rounded-lg border px-3 py-1.5 text-sm hover:bg-gray-50"},{default:Je(()=>[...t[37]||(t[37]=[_("← Back",-1)])]),_:1})])]),e("div",wt,[e("div",_t,[e("button",{onClick:t[0]||(t[0]=l=>b.value="calendar"),class:z(["px-4 py-2 rounded-lg text-sm transition",s(b)==="calendar"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Calendar",2),e("button",{onClick:t[1]||(t[1]=l=>b.value="changelog"),class:z(["px-4 py-2 rounded-lg text-sm transition",s(b)==="changelog"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Changelog",2),e("button",{onClick:t[2]||(t[2]=l=>b.value="forms"),class:z(["px-4 py-2 rounded-lg text-sm transition",s(b)==="forms"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Forms",2),e("button",{onClick:t[3]||(t[3]=l=>b.value="notes"),class:z(["px-4 py-2 rounded-lg text-sm transition",s(b)==="notes"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Notes",2),e("button",{onClick:t[4]||(t[4]=l=>b.value="details"),class:z(["px-4 py-2 rounded-lg text-sm transition",s(b)==="details"?"bg-white shadow-sm":"text-gray-600 hover:bg-white/60"])},"Details",2)])])]),s(Re)?(n(),o("div",kt,"Loading…")):s(Se)?(n(),o("div",Ut,"Failed to load site.")):r((n(),o("div",Ct,[t[38]||(t[38]=e("h2",{class:"text-lg font-semibold"},"Maintenance calendar",-1)),e("div",Mt,[(n(!0),o($,null,R(s($e),l=>(n(),o("div",{key:l.start.toISOString(),class:"rounded-2xl border bg-white p-5 shadow-sm"},[e("div",$t,[e("h3",Rt,d(Me(l.start)),1),De(l.start)?(n(),o("span",St,"Renewal")):u("",!0)]),e("div",Dt,[(n(!0),o($,null,R(s(me).filter(x=>re(x,l)),x=>(n(),o("div",{key:x.date,class:"rounded-xl border px-3 py-2 flex items-center justify-between hover:bg-gray-50"},[e("div",null,[e("div",Nt,d(new Date(x.date).toLocaleDateString()),1),e("div",Tt,d(x.kind==="report"||x.labels?.reportDue?"Report due":"Maintenance"),1)]),e("div",Vt,[x.labels?.reportDue?(n(),o("span",Pt,"Report")):u("",!0),x.labels?.preRenewal?(n(),o("span",Ft,"Pre-renewal")):u("",!0),x.labels?.midYear?(n(),o("span",Et,"Mid-year")):u("",!0)])]))),128)),s(me).some(x=>re(x,l))?u("",!0):(n(),o("div",Lt," No maintenance scheduled. "))])]))),128))])],512)),[[G,s(b)==="calendar"]]),r(e("div",jt,[t[47]||(t[47]=e("h2",{class:"text-lg font-semibold"},"Changelog",-1)),e("div",At,[e("div",Ot,[e("div",Wt,[t[40]||(t[40]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Environment",-1)),r(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>M(h)?h.value=l:null),class:"w-full rounded-lg border px-3 py-2"},[t[39]||(t[39]=e("option",{value:""},"All",-1)),e("option",{value:s(m)?.env},d(s(m)?.env),9,Ht)],512),[[de,s(h)]])]),e("div",It,[t[41]||(t[41]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Package",-1)),r(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>M(A)?A.value=l:null),placeholder:"vendor/package",class:"w-full rounded-lg border px-3 py-2"},null,512),[[p,s(A)]])]),e("div",Bt,[t[42]||(t[42]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"From",-1)),r(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>M(O)?O.value=l:null),type:"datetime-local",class:"w-full rounded-lg border px-3 py-2"},null,512),[[p,s(O)]])]),e("div",qt,[t[43]||(t[43]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"To",-1)),r(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>M(W)?W.value=l:null),type:"datetime-local",class:"w-full rounded-lg border px-3 py-2"},null,512),[[p,s(W)]])]),e("div",zt,[r(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>M(T)?T.value=l:null),type:"number",min:"1",class:"w-24 rounded-lg border px-3 py-2"},null,512),[[p,s(T),void 0,{number:!0}]]),e("button",{onClick:t[10]||(t[10]=(...l)=>s(ge)&&s(ge)(...l)),class:"ml-auto inline-flex items-center rounded-lg bg-black px-4 py-2 text-white disabled:opacity-50",disabled:s(xe)},"Refresh",8,Gt)])]),s(xe)?(n(),o("div",Yt,"Loading changes…")):(s(be)?.items||[]).length===0?(n(),o("div",Jt,"No changelog entries.")):(n(),o("div",Kt,[(n(!0),o($,null,R(s(be)?.items||[],(l,x)=>(n(),o("div",{key:l._id||l.run?.timestamp||x,class:"rounded-xl border p-4"},[e("div",Qt,[e("div",null,[e("div",Xt,d(new Date(l.run?.timestamp||l.receivedAt).toLocaleString()),1),e("div",Zt,[_(d(l.site?.env)+" ",1),l.run?.git_branch?(n(),o("span",es," • "+d(l.run.git_branch),1)):u("",!0),l.run?.git_sha?(n(),o("span",ts," ("+d(l.run.git_sha)+")",1)):u("",!0)])]),e("div",ss,[e("span",ls,"Updated: "+d(l.summary?.updated_count||0),1),e("span",os,"Added: "+d(l.summary?.added_count||0),1),e("span",ns,"Removed: "+d(l.summary?.removed_count||0),1)])]),l.summary?.has_changes?(n(),o("div",as,[e("table",ds,[t[46]||(t[46]=e("thead",{class:"bg-gray-50"},[e("tr",{class:"text-left"},[e("th",{class:"py-2 pl-3 pr-4 font-medium text-gray-600"},"Package"),e("th",{class:"py-2 pr-4 font-medium text-gray-600"},"Old"),e("th",{class:"py-2 pr-4 font-medium text-gray-600"},"New")])],-1)),e("tbody",null,[(n(!0),o($,null,R(l.changes?.updated||[],f=>(n(),o("tr",{key:"u-"+f.name,class:"border-t"},[e("td",is,d(f.name),1),e("td",rs,[e("code",null,d(f.old),1)]),e("td",us,[e("code",null,d(f.new),1)])]))),128)),(n(!0),o($,null,R(l.changes?.added||[],f=>(n(),o("tr",{key:"a-"+f.name,class:"border-t"},[e("td",ms,d(f.name),1),t[44]||(t[44]=e("td",{class:"py-2 pr-4"},[e("em",null,"—")],-1)),e("td",cs,[e("code",null,d(f.new),1)])]))),128)),(n(!0),o($,null,R(l.changes?.removed||[],f=>(n(),o("tr",{key:"r-"+f.name,class:"border-t"},[e("td",ps,d(f.name),1),e("td",bs,[e("code",null,d(f.old),1)]),t[45]||(t[45]=e("td",{class:"py-2 pr-4"},[e("em",null,"—")],-1))]))),128))])])])):(n(),o("div",xs,"No dependency changes.")),e("div",gs,[l.run?.ci_url?(n(),o("a",{key:0,href:l.run.ci_url,target:"_blank",class:"text-blue-600 hover:underline text-sm"},"CI build",8,vs)):u("",!0)])]))),128)),e("div",{class:"flex justify-center"},[e("button",{onClick:Ne,class:"rounded-lg border px-4 py-2 text-sm hover:bg-gray-50"},"Load more")])]))])],512),[[G,s(b)==="changelog"]]),r(e("div",ys,[t[55]||(t[55]=e("h2",{class:"text-lg font-semibold"},"Forms",-1)),e("div",fs,[e("div",hs,[e("div",null,[t[49]||(t[49]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Environment",-1)),r(e("select",{"onUpdate:modelValue":t[11]||(t[11]=l=>M(h)?h.value=l:null),class:"w-full rounded-lg border px-3 py-2"},[t[48]||(t[48]=e("option",{value:""},"All",-1)),e("option",{value:s(m)?.env},d(s(m)?.env),9,ws)],512),[[de,s(h)]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Email",-1)),r(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>M(H)?H.value=l:null),placeholder:"name@plott.co.uk",class:"w-full rounded-lg border px-3 py-2"},null,512),[[p,s(H)]])]),e("div",null,[t[51]||(t[51]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"From",-1)),r(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>M(I)?I.value=l:null),type:"datetime-local",class:"w-full rounded-lg border px-3 py-2"},null,512),[[p,s(I)]])]),e("div",null,[t[52]||(t[52]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"To",-1)),r(e("input",{"onUpdate:modelValue":t[14]||(t[14]=l=>M(B)?B.value=l:null),type:"datetime-local",class:"w-full rounded-lg border px-3 py-2"},null,512),[[p,s(B)]])]),e("div",_s,[r(e("input",{"onUpdate:modelValue":t[15]||(t[15]=l=>M(V)?V.value=l:null),type:"number",min:"1",class:"w-24 rounded-lg border px-3 py-2"},null,512),[[p,s(V),void 0,{number:!0}]]),e("button",{onClick:t[16]||(t[16]=(...l)=>s(fe)&&s(fe)(...l)),class:"ml-auto inline-flex items-center rounded-lg bg-black px-4 py-2 text-white disabled:opacity-50",disabled:s(ye)},"Refresh",8,ks)])]),s(ye)?(n(),o("div",Us,"Loading submissions…")):(s(ve)?.items||[]).length===0?(n(),o("div",Cs,"No form submissions.")):(n(),o("div",Ms,[(n(!0),o($,null,R(s(ve)?.items||[],(l,x)=>(n(),o("div",{key:l._id||x,class:"rounded-xl border p-4"},[e("div",$s,[e("div",null,[e("div",Rs,d(new Date(l.entry?.created_at||l.receivedAt).toLocaleString()),1),e("div",Ss,d(l.form?.title||"Form")+" • "+d(l.entry?.email),1)]),t[53]||(t[53]=e("span",{class:"px-2 py-1 rounded-full text-xs bg-purple-50 text-purple-700"},"GF submission",-1))]),e("div",Ds,[e("table",Ns,[t[54]||(t[54]=e("thead",{class:"bg-gray-50"},[e("tr",{class:"text-left"},[e("th",{class:"py-2 pl-3 pr-4 font-medium text-gray-600"},"Field"),e("th",{class:"py-2 pr-4 font-medium text-gray-600"},"Value")])],-1)),e("tbody",null,[(n(!0),o($,null,R(l.fields||{},(f,we)=>(n(),o("tr",{key:we,class:"border-t align-top"},[e("td",Ts,d(we),1),e("td",Vs,d(f),1)]))),128))])])]),e("p",Ps," PHP "+d(l.run?.php_version)+" • WP "+d(l.run?.wp_version)+" • GF "+d(l.run?.gf_version),1)]))),128)),e("div",{class:"flex justify-center"},[e("button",{onClick:Te,class:"rounded-lg border px-4 py-2 text-sm hover:bg-gray-50"},"Load more")])]))])],512),[[G,s(b)==="forms"]]),r(e("div",Fs,[t[57]||(t[57]=e("h2",{class:"text-lg font-semibold"},"Notes",-1)),L?(n(),o("div",Es,[e("div",Ls,[r(e("input",{"onUpdate:modelValue":t[17]||(t[17]=l=>s(U).title=l),placeholder:"Title",class:"border rounded-lg px-3 py-2 md:col-span-3"},null,512),[[p,s(U).title]]),e("label",js,[r(e("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=l=>s(U).pinned=l)},null,512),[[Ke,s(U).pinned]]),t[56]||(t[56]=_(" Pinned ",-1))])]),r(e("textarea",{"onUpdate:modelValue":t[19]||(t[19]=l=>s(U).body=l),rows:"4",placeholder:"Write a note…",class:"border rounded-lg px-3 py-2 w-full"},null,512),[[p,s(U).body]]),e("div",As,[e("button",{onClick:Ve,disabled:s(J),class:"rounded-lg bg-black px-4 py-2 text-white"},d(s(J)?"Saving…":"Add note"),9,Os),e("button",{onClick:N,class:"rounded-lg border px-4 py-2 hover:bg-gray-50"},"Refresh")])])):(n(),o("div",Ws," Sign in to add and manage notes. ")),e("div",Hs,[s(P)?.items?s(P).items.length===0?(n(),o("div",Bs," No notes yet. ")):(n(!0),o($,{key:2},R(s(P).items,l=>(n(),o("div",{key:l._id,class:"rounded-xl border bg-white p-4 shadow-sm"},[e("div",qs,[e("div",null,[e("div",zs,[e("h3",Gs,d(l.title||"Untitled"),1),l.pinned?(n(),o("span",Ys,"Pinned")):u("",!0)]),e("p",Js,d(l.body),1),e("p",Ks," by "+d(l.author?.name||l.author?.email)+" • "+d(new Date(l.updatedAt).toLocaleString()),1)]),Pe(l)?(n(),o("div",Qs,[e("button",{onClick:x=>Fe(l,{pinned:!l.pinned}),class:"text-xs underline"},d(l.pinned?"Unpin":"Pin"),9,Xs),e("button",{onClick:x=>Ee(l),class:"text-xs text-red-600 underline"},"Delete",8,Zs)])):u("",!0)])]))),128)):(n(),o("div",Is,[e("button",{onClick:N,class:"rounded-lg border px-4 py-2 hover:bg-gray-50"},"Load notes")]))])],512),[[G,s(b)==="notes"]]),r(e("div",el,[t[72]||(t[72]=e("h2",{class:"text-lg font-semibold"},"Site details",-1)),e("div",tl,[e("div",sl,[e("div",null,[t[58]||(t[58]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Site ID",-1)),e("input",{value:s(v),disabled:"",class:"w-full rounded-lg border bg-gray-50 px-3 py-2"},null,8,ll)]),e("div",null,[t[59]||(t[59]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Name",-1)),r(e("input",{"onUpdate:modelValue":t[20]||(t[20]=l=>s(i).name=l),class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},null,8,ol),[[p,s(i).name]])]),e("div",null,[t[61]||(t[61]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Environment",-1)),r(e("select",{"onUpdate:modelValue":t[21]||(t[21]=l=>s(i).env=l),class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},[...t[60]||(t[60]=[e("option",{value:"production"},"production",-1),e("option",{value:"staging"},"staging",-1),e("option",{value:"dev"},"dev",-1),e("option",{value:"test"},"test",-1)])],8,nl),[[de,s(i).env]])]),e("div",null,[t[62]||(t[62]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Renew month (1–12)",-1)),r(e("input",{"onUpdate:modelValue":t[22]||(t[22]=l=>s(i).renewMonth=l),type:"number",min:"1",max:"12",class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},null,8,al),[[p,s(i).renewMonth,void 0,{number:!0}]]),t[63]||(t[63]=e("p",{class:"mt-1 text-xs text-gray-500"},"Pre-renewal (R−2), Reports due (R−1), Mid-year (pre+6).",-1))])]),e("div",dl,[e("div",null,[t[64]||(t[64]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Website URL",-1)),r(e("input",{"onUpdate:modelValue":t[23]||(t[23]=l=>s(i).websiteUrl=l),placeholder:"https://example.com",class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},null,8,il),[[p,s(i).websiteUrl]])]),e("div",null,[t[65]||(t[65]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Git URL",-1)),r(e("input",{"onUpdate:modelValue":t[24]||(t[24]=l=>s(i).gitUrl=l),placeholder:"https://github.com/org/repo",class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},null,8,rl),[[p,s(i).gitUrl]])])]),e("div",ul,[e("div",null,[t[66]||(t[66]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Contact name",-1)),r(e("input",{"onUpdate:modelValue":t[25]||(t[25]=l=>s(i).contactName=l),class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},null,8,ml),[[p,s(i).contactName]])]),e("div",null,[t[67]||(t[67]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Contact email",-1)),r(e("input",{"onUpdate:modelValue":t[26]||(t[26]=l=>s(i).contactEmail=l),type:"email",placeholder:"name@example.com",class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},null,8,cl),[[p,s(i).contactEmail]])]),e("div",null,[t[68]||(t[68]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Contact phone",-1)),r(e("input",{"onUpdate:modelValue":t[27]||(t[27]=l=>s(i).contactPhone=l),placeholder:"+44 ...",class:"w-full rounded-lg border px-3 py-2",disabled:!s(y)},null,8,pl),[[p,s(i).contactPhone]])])]),e("div",bl,[s(y)?(n(),o("button",{key:0,onClick:Le,disabled:s(Q),class:"rounded-lg bg-black px-4 py-2 text-white disabled:opacity-50"},d(s(Q)?"Saving…":"Save details"),9,xl)):u("",!0),s(X)?(n(),o("p",gl,d(s(X)),1)):u("",!0),s(Z)?(n(),o("p",vl,d(s(Z)),1)):u("",!0),s(y)?u("",!0):(n(),o("p",yl,"Sign in as a manager or admin to edit."))]),e("div",fl,[e("div",hl,[e("div",null,[t[69]||(t[69]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Backfill months",-1)),r(e("input",{"onUpdate:modelValue":t[28]||(t[28]=l=>s(F).backfillMonths=l),type:"number",min:"0",max:"60",class:"w-28 rounded-lg border px-3 py-2",disabled:!s(y)||s(E)},null,8,wl),[[p,s(F).backfillMonths,void 0,{number:!0}]])]),e("div",null,[t[70]||(t[70]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Forward months",-1)),r(e("input",{"onUpdate:modelValue":t[29]||(t[29]=l=>s(F).forwardMonths=l),type:"number",min:"0",max:"60",class:"w-28 rounded-lg border px-3 py-2",disabled:!s(y)||s(E)},null,8,_l),[[p,s(F).forwardMonths,void 0,{number:!0}]])]),s(y)?(n(),o("button",{key:0,onClick:je,disabled:s(E),class:"ml-auto rounded-lg bg-rose-600 px-4 py-2 text-white hover:bg-rose-700 disabled:opacity-50",title:"Deletes and regenerates Pre (R−2), Report (R−1), Mid (+6) entries"},d(s(E)?"Rebuilding…":"Rebuild maintenance"),9,kl)):u("",!0)]),t[71]||(t[71]=e("p",{class:"mt-2 text-xs text-gray-600"}," Rebuild deletes existing entries for this site/env and recreates: Pre-renewal (R−2), Report due (R−1), and Mid-year (pre+6) across the selected window. ",-1)),s(ee)?(n(),o("p",Ul,d(s(ee)),1)):u("",!0),s(te)?(n(),o("p",Cl,d(s(te)),1)):u("",!0)])])],512),[[G,s(b)==="details"]])])}}});export{Nl as default};
